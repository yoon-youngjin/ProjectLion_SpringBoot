## 1. 배치 어플리케이션이란?

배치(batch)는 일괄처리란 뜻을 갖고 있습니다.
만약 매일 전 날의 데이터를 집계 해야한다고 가정하면, 이렇게 큰 데이터를 읽고, 가공하고, 저장한다면 웹 어플리케이션 서버는 순식간에 CPU, I/O 등의 자원을 다써버려서 다른 Request 처리를 못하게 됩니다.

그리고 이러한 집계 기능은 하루 1번 수행됩니다. 이를 위해 API를 구성하는 것은 낭비입니다.
추가로 데이터가 너무 많아서 처리 중에 실패가 발생하면 어떻게 될까요?
**5만번째에서 실패했다면, 5만 1번째부터 다시 실행**할 수 있다면 얼마나 좋을까요?

또 이런 경우도 있을 수 있습니다. 오늘 아침 누군가가 집계 함수를 실행시켰는데, 다른 누군가가 또 실행시켜 집계 데이터가 2배로 뻥튀기 될 수도 있습니다. 
**같은 파라미터로 같은 함수를 실행할 경우** 이미 실행한 적이 있어 실패하는 기능을 지원한다면 얼마나 좋을까요?

바로 이런 단발성으로 대용량의 데이터를 처리하는 어플리케이션 **배치 어플리케이션**이라고 합니다.
위의 고민들을 다시 생각해보면 배치 어플리케이션을 구성하기 위해선 **비즈니스 로직 외에 부가적으로 신경써야할 부분들이 많다**는 것을 알 수 있습니다.

Spring에서 배치 어플리케이션을 지원하는 모듈로 **Spring Batch**가 있습니다. 

**배치 어플리케이션의 조건**
- 대용량 데이터 : 배치 어플리케이션은 대량의 데이터를 가져오거나, 전달하거나, 계산하는 등의 처리를 할 수 있어야 합니다.
- 자동화 : 배치 어플리케이션은 심각한 문제 해결을 제외하고는 **사용자 개입 없이 실행**되어야 합니다.
- 견고성 : 배치 어플리케이션은 잘못된 데이터를 충돌/중단 없이 처리할 수 있어야 합니다. 
- 신뢰성 : 배치 어플리케이션은 무엇이 잘못되었는지를 추적할 수 있어야 합니다.(로깅, 알림)
- 성능 : 배치 어플리케이션은 **지정한 시간 안에 처리를 완료**하거나 동시에 실행되는 **다른 어플리케이션을 방해하지 않도록 수행**되어야 합니다.

### 1.1 Spring Batch?

Spring Batch는 Spring의 특성을 그대로 가져왔습니다. 
그래서 **DI, AOP, 서비스 추상화**등 Spring 프레임워크의 3대 요소를 모두 사용할 수 있습니다.

### 1.2 Batch vs. Quartz?

Batch와 Quartz의 역할은 완전히 다릅니다. Quartz는 스케줄러의 역할이지, Batch와 같이 **대용량 데이터 배치 처리에 대한 기능을 지원하지 않습니다.**
반대로 Batch 역시 Quartz의 다양한 스케줄 기능을 지원하지 않아서 보통은 Quartz + Batch를 조합해서 사용합니다. 
정해진 스케줄마다 Quartz가 Spring Batch를 실행하는 구조라고 보시면 됩니다.

### 1.3 Batch 사례

#### 일매출 집계

많은 거래가 이루어지는 커머스 사이트의 경우 하루 거래건이 50만 ~ 100만까지 나옵니다.
이럴 경우 이와 관련된 데이터는 최소 100만 ~ 200만 row 이상입니다. 한달이면 5000만 ~ 1억까지 될 수도 있습니다.

이를 실시간 집계 쿼리로 해결하기엔 조회 시간이나 서버 부하가 심합니다. 그래서 매일 새벽에 전날의 매출 집계 데이터를 만들어서 외부 요청이 올 경우 미리 만들어둔 집계 데이터를 바로 전달하면 성능과 부하를 모두 잡을 수 있습니다.

![image](https://github.com/yoon-youngjin/spring-study/assets/83503188/b8a3985a-50c2-4557-b3ec-24fdbe5e7e01)

#### ERP 연동

ERP(Enterprise Resource Planning)는 자원 관리 시스템입니다. 사내 구성원을 비롯해서 매출, 지출 등을 모두 관리하는 소프트웨어 시스템을 얘기합니다. 
재무팀의 요구사항으로 매일 매출 현황을 ERP로 전달해야하는 상황에서 Spring Batch가 많이 사용됩니다. 

![image](https://github.com/yoon-youngjin/spring-study/assets/83503188/9469b588-5712-457f-b878-c8da74b8dc2b)
