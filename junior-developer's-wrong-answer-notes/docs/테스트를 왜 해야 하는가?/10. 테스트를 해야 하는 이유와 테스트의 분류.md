# 테스트에 필요한 개념

## 개념

### SUT

SUT(System Under Test)는 테스트 하려는 대상을 의미한다.

```java
@Test
void 유저는_북마크를_toggle_추가_할_수있다() {
    // given
    User user = User.builder()
        .bookmark(new ArrayList<>())
        .build()
    
    // when
    user.toggleBookmark("my-link");
    
    // then
        ...
}
```

위와 같은 코드에서 user가 SUT이다.

### TDD

TDD는 테스트 주도 개발을 의미한다.

1. 깨지는 테스트를 먼저 작성한다. -> red
2. 깨지는 테스트를 성공시킨다. -> green
   - 코드 퀄리티는 신경쓰지 않고 테스트만 통과하도록 구현
3. 리팩토링한다. -> blue
   - 코드 퀄리티를 챙긴다.

### BDD

BDD(Behaviour Driven Development, given-when-then)은 기본적으로 TDD에 한가지 더한 내용이다.

테스트 코드를 작성하다보면 모든 메소드를 다 테스트하고 싶은 욕구가 생기는데, 메소드 위주의 테스트 코드보다 시나리오에 기반한 테스트 방식을 의미한다.

### 불규칙한 테스트(flaky)

대상 코드에 아무런 변경이 없음에도 불구하고 실패하는 테스트를 의미한다. 

### 깨지기 쉬운 테스트(brittle)

실제로 버그가 없음에도, 심지어 검증 대상 코드와 관련조차 없는 변경 때문에 실패하는 테스트를 의미한다.

### 상호 작용 테스트(Interaction test)

메소드가 실제로 호출이 됐는지 검즈앟는 테스트를 상호 작용 테스트라고 한다.

```java
@Test
void 유저는_북마크를_toggle_추가_할_수있다() {
    // ...
    
    // then
    verify(user).markModified; // Interaction Test    
}
```

일반적으로 상호 작용 테스트는 그닥 좋은 방법이 아니다.
그 이유는 내부 구현을 감시하는 것인데 이는 캡슐화를 위반한다.

따라서 상호 작용 테스트보다는 상태를 테스트하는 코드를 만드는 게 좋다.

```java
@Test
void 유저는_북마크를_toggle_추가_할_수있다() {
    // ...
    
    // then
    assertThat(user.isModified()).isTrue();    
}
```

### 테스트 더블 

진짜 객체로 테스트하는 것이 아닌 가짜 객체로 테스트하는 것을 의미한다.

**대역**
1. Dummy : 일을 시켜도 아무런 동작을 하지 않는 객체, 그저 코드가 정상적으로 돌아가기 위해 전달하는 용도
2. Fake : Local에서 사용하거나 테스트에서 사용하기 위해 만들어진 가짜 객체, 자체적인 로직이 있다는게 특징
3. Stub : 미리 준비된 값을 출력하는 객체, 주로 외부 연동하는 컴포넌트에 많이 사용한다.
   - 일반적으로 Mockito 프레임워크를 이용해서 사용한다.
4. Mock : 테스트 더블하고 거의 동일, 메소드 호출을 확인하기 위한 객체, 자가 검증 능력을 갖춤
   - stub도 Mock, dummy도 Mock, fake도 Mock이라고 부르기도 한다.
   - 의미가 혼란
5. Spy : 메소드 호출을 전부 기록했다가 나중에 확인하기 위한 객체
   - 메소드가 몇 번 호출됐는지, 잘 호출됐는지 등을 검증한다.

